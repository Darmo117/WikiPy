(function(){"use strict";Array.prototype.remove=function(value){let index=this.indexOf(value);if(index>-1){this.splice(index,1);}};let WPY_CONF={};for(let[k,v]of Object.entries(window.WPY_CONF||{})){WPY_CONF[k]=v;}
delete window.WPY_CONF;class LockableMap extends Map{constructor(){super();this._immutable=false;}
setImmutable(){this._immutable=true;}
set(key,value){if(this._immutable){throw new Error("Map object is immutable");}
super.set(key,value);}
_immutable;}
let config=new LockableMap();for(let[k,v]of Object.entries(WPY_CONF)){if(!k.endsWith("PageTitle")&&!k.endsWith("NamespaceName")&&!k.endsWith("NamespaceId")&&!k.startsWith("wpyUser")&&k!=="wpyTranslations"&&!["wpyAction","wpyContentType","wpySkin"].includes(k)||k==="wpyMainNamespaceName"){config.set(k,v);}}
config.setImmutable();window.wpy={LockableMap:LockableMap,config:config,encodePageTitleUrl:function(s){return s.replaceAll(" ","_").replaceAll("?","%3F");},translate:function(key,args){let string=WPY_CONF["wpyTranslations"][key]||key;for(let[k,v]of Object.entries(args||{})){string=string.replace(`\${${k}}`,`${v}`);}
return string;},when:function(dependencies,callback){if(typeof dependencies==="string"){dependencies=[dependencies];}else if(!(dependencies instanceof Array)){throw new TypeError("dependencies must be a string or array of strings");}
if(typeof callback!=="function"){throw new TypeError("callback must be callable");}
let toRemove=[];for(let d of dependencies){if(this.getModule(d)){toRemove.push(d);}}
toRemove.forEach(d=>dependencies.remove(d));if(!dependencies.length){callback();}else{this._eventsQueue.set(callback,dependencies);}},registerModule:function(moduleName,f){if(!/^\w+(\.\w+)*$/.exec(moduleName)){console.error(`Invalid module name "${moduleName}", skipped.`);return;}
if(this.getModule(moduleName)){console.error(`A module with the name "${moduleName}" is already registered, skipped.`);return;}
let module=f();module.id=moduleName;this._modules[moduleName]=module;let toRemove=[];for(let[callback,dependencies]of this._eventsQueue){if(dependencies.includes(moduleName)){dependencies.remove(moduleName);if(!dependencies.length){callback();toRemove.push(callback);}}}
toRemove.forEach(d=>this._eventsQueue.delete(d));},getModule:function(id){return this._modules[id];},isModuleLoaded:function(id){return!!this.getModule(id);},currentPage:{getTitle:function(asUrl){let key="PageTitle";if(asUrl){key="Url"+key;}
return WPY_CONF["wpy"+key];},getSpecialPageTitle:function(asUrl,canonical){let key="SpecialPageTitle";if(canonical){key="Canonical"+key;}
if(asUrl){key="Url"+key;}
return WPY_CONF["wpy"+key];},getFullTitle:function(asUrl){let key="FullPageTitle";if(asUrl){key="Url"+key;}
return WPY_CONF["wpy"+key];},getNamespaceName:function(asUrl,canonical){let key="NamespaceName";if(canonical){key="Canonical"+key;}
if(asUrl){key="Url"+key;}
return WPY_CONF["wpy"+key];},getNamespaceId:function(){return WPY_CONF["wpyNamespaceId"];},getAction:function(){return WPY_CONF["wpyAction"];},getContentType:function(){return WPY_CONF["wpyContentType"];},getSkin:function(){return WPY_CONF["wpySkin"];},},currentUser:{getName:function(){return WPY_CONF["wpyUserName"];},getId:function(){return WPY_CONF["wpyUserId"];},isLoggedIn:function(){return WPY_CONF["wpyUserIsLoggedIn"];},getGroups:function(){return WPY_CONF["wpyUserGroups"];},},toast:{show:function(title,message,autoHide,hideDelay){autoHide=!!autoHide;hideDelay=Math.floor(hideDelay||0);let closeTooltip=wpy.translate("toast.close.tooltip");let $toast=$(`
          <div class="toast" role="alert" aria-live="assertive" aria-atomic="true"
              data-delay="${hideDelay * 1000}" data-autohide="${autoHide}">
            <div class="toast-header">
              <strong class="mr-auto">${title}</strong>
              <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="${closeTooltip}"
                  title="${closeTooltip}">
                <span aria-hidden="true">Ã—</span>
              </button>
            </div>
            <div class="toast-body">${message}</div>
          </div>
        `.trim());$("#wpy-toasts-area").append($toast);$toast.toast("show");$toast.on("hidden.bs.toast",function(){$toast.remove();})}},_modules:{},_eventsQueue:new Map(),};let accessKeyLabel="alt+shift+";$("*[accesskey]").each(function(_,e){let $element=$(e);let tooltip=$element.attr("title");let accessKey=$element.attr("accesskey");if(tooltip){$element.attr("title",$element.attr("title")+` [${accessKeyLabel + accessKey}]`);}});function addLanguageParam(url,value){let params=new URLSearchParams(url.search);params.set("use_lang",value);url.search=params.toString();}
let $languageSelector=$("#wpy-language-select");if($languageSelector.length){$languageSelector.val(wpy.config.get("wpyLanguageCode"));$languageSelector.change(function(){let language=$(this).val();let url=new URL(location.href);addLanguageParam(url,language);location.href=url.toString();});let language=new URL(location.href).searchParams.get("use_lang");if(language){$("a:not([data-toggle])").each(function(){let $anchor=$(this);let href=$anchor.prop("href");if(href){let url=new URL(href);if(url.hostname===location.hostname){addLanguageParam(url,language);$anchor.prop("href",url.toString());}}});}}
$("#wpy-change-email-resend").click(function(){$.get(wpy.config.get("wpyApiUrlPath"),{"action":"send_confirmation_email","format":"json",},function(data){if(data["sent"]){wpy.toast.show(wpy.translate("toast.email_sent.title"),wpy.translate("toast.email_sent.message"),true,5)}});return false;});})();